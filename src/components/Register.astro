---
import Button from "./Button.astro";
import Input from "./Input.astro";
---

<article
  id="register"
  class="bg-primary text-primary-contrast flex flex-col items-center justify-around gap-4 p-6 md:flex-row"
>
  <div class="flex-1">
    a
    <img src="" alt="" />
  </div>
  <section class="flex-1">
    <h2 class="text-center text-2xl font-bold md:text-start">
      ¡Regístrate ahora!
    </h2>
    <p class="mt-2 mb-4 text-base text-pretty text-gray-300">
      Accede a la información exclusiva. Descubri por fin una gestión sencilla
      para el cuidado de tu mascota. Te enviaremos todos lso detalles a tu
      correo.
    </p>

    <form id="registerForm">
      <Input
        label="Nombre Completo"
        type="text"
        id="name"
        placeholder="Tu nombre"
      >
        <svg
          slot="icon"
          class="h-4 w-4 text-gray-500 dark:text-gray-400"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          fill="currentColor"
          viewBox="0 0 20 16"
        >
          <path
            d="m10.036 8.278 9.258-7.79A1.979 1.979 0 0 0 18 0H2A1.987 1.987 0 0 0 .641.541l9.395 7.737Z"
          ></path>
          <path
            d="M11.241 9.817c-.36.275-.801.425-1.255.427-.428 0-.845-.138-1.187-.395L0 2.6V14a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V2.5l-8.759 7.317Z"
          ></path>
        </svg>
      </Input>

      <Input
        label="Correo Electronico"
        type="email"
        id="email"
        placeholder="tucorreo@ejemplo.com"
      >
        <svg
          slot="icon"
          class="h-4 w-4 text-gray-500 dark:text-gray-400"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          fill="currentColor"
          viewBox="0 0 20 20"
        >
          <path
            d="M10 0a10 10 0 1 0 10 10A10.011 10.011 0 0 0 10 0Zm0 5a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm0 13a8.949 8.949 0 0 1-4.951-1.488A3.987 3.987 0 0 1 9 13h2a3.987 3.987 0 0 1 3.951 3.512A8.949 8.949 0 0 1 10 18Z"
          ></path>
        </svg>
      </Input>
      <Button variant="secondary" type="submit" class="w-full"
        >Registrarme</Button
      >
    </form>
  </section>
</article>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("registerForm") as HTMLFormElement;

    if (form) {
      form.addEventListener("submit", async function (e) {
        e.preventDefault();

        // Get form data
        const formData = new FormData(form);
        const data = {
          name: formData.get("name"),
          email: formData.get("email"),
        };

        try {
          // Make fetch request
          const response = await fetch("/api/register", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          });

          if (response.ok) {
            const result = await response.json();
            console.log("Registration successful:", result);
            // You can add success handling here (e.g., show success message, redirect)
            alert("¡Registro exitoso!");
          } else {
            console.error("Registration failed:", response.statusText);
            alert("Error en el registro. Por favor, intenta de nuevo.");
          }
        } catch (error) {
          console.error("Network error:", error);
          alert(
            "Error de conexión. Por favor, verifica tu conexión a internet.",
          );
        }
      });
    }
  });
</script>
